<!-- User Stories & Requirements for the code below:

- This is a single-page HTML web app.
- A monospace font should be used.
- No backend; all data is stored locally (if needed).
- The app should be usable offline.

Main user stories:
- Prevent Microsoft Teams from marking the user as 'Away' due to inactivity.
- Simulate user activity through periodic mouse movements and keyboard inputs.
- Ensure the simulation runs seamlessly in the background without user intervention.

Keep this comment block in the code.
Simplify the code if possible (without removing the functionality described above).
You MUST keep all comments in the code below, even if you think they are redundant.
Always respond with the full new HTML file (including these comments here),
additional explanations of what you change are nice to have but not necessary.
-->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Teams Status Preserver</title>
  <!-- Favicon: An active status indicator --> 
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='40' fill='%2322c55e'/%3E%3Ccircle cx='50' cy='50' r='30' fill='%23dcfce7'/%3E%3Ccircle cx='50' cy='50' r='20' fill='%2322c55e'/%3E%3C/svg%3E" type="image/svg+xml">
  <!-- Added Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="p-5 font-mono leading-relaxed max-w-3xl mx-auto">
  <h1 class="text-2xl font-bold mb-4">Teams Status Preserver</h1>
  
  <div class="border border-gray-300 p-5 mt-5 rounded-md">
    <p><strong>How it works:</strong> This app simulates browser events to keep your Microsoft Teams status active even during periods of inactivity.</p>
    
    <div class="p-2.5 my-2.5 bg-gray-100 rounded-md" id="statusDisplay">
      Status: <span id="status" class="text-green-600">Active</span>
    </div>
    
    <div>
      <button id="toggleBtn" class="px-4 py-2 bg-blue-600 text-white rounded font-mono mr-2.5 cursor-pointer hover:bg-blue-700">Pause</button>
      <span id="nextEvent"></span>
    </div>
    
    <h3 class="mt-4 font-bold">Recent Activity:</h3>
    <div id="eventLog" class="h-24 overflow-y-auto border border-gray-300 p-2.5 mt-2.5 text-xs"></div>
  </div>
  
  <video class="hidden" autoplay loop muted playsinline>
    <source src="https://www.w3schools.com/html/mov_bbb.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>

  <script>
    let position = 0;
    let active = true;
    let mouseInterval, keyInterval;
    let lastMouseEvent = Date.now();
    let lastKeyEvent = Date.now();
    
    // DOM elements
    const statusElement = document.getElementById('status');
    const toggleBtn = document.getElementById('toggleBtn');
    const eventLog = document.getElementById('eventLog');
    const nextEventSpan = document.getElementById('nextEvent');

    // Simulates mouse movement by incrementing position
    function simulateMouseMove() {
      if (!active) return;
      
      const evt = new MouseEvent("mousemove", {
        clientX: position % window.innerWidth,
        clientY: position % window.innerHeight,
        bubbles: true,
        cancelable: true,
        view: window
      });
      document.dispatchEvent(evt);
      position++;
      lastMouseEvent = Date.now();
      
      logEvent("Mouse event triggered");
      updateNextEventTime();
    }

    // Simulates a Shift key press
    function simulateKeyPress() {
      if (!active) return;
      
      const evt = new KeyboardEvent("keydown", {
        key: "Shift",
        code: "ShiftLeft",
        bubbles: true
      });
      document.dispatchEvent(evt);
      lastKeyEvent = Date.now();
      
      logEvent("Keyboard event triggered");
      updateNextEventTime();
    }
    
    // Log events to the UI
    function logEvent(message) {
      const timestamp = new Date().toLocaleTimeString();
      const logEntry = document.createElement('div');
      logEntry.textContent = `${timestamp}: ${message}`;
      eventLog.prepend(logEntry);
      
      // Limit log entries
      if (eventLog.children.length > 20) {
        eventLog.removeChild(eventLog.lastChild);
      }
    }
    
    // Update the countdown to next event
    function updateNextEventTime() {
      const now = Date.now();
      const nextMouseIn = 15000 - (now - lastMouseEvent);
      const nextKeyIn = 60000 - (now - lastKeyEvent);
      const nextEvent = Math.min(nextMouseIn, nextKeyIn);
      
      nextEventSpan.textContent = `Next event in: ${Math.ceil(nextEvent / 1000)}s`;
    }
    
    // Toggle active state
    function toggleActive() {
      active = !active;
      
      if (active) {
        statusElement.textContent = "Active";
        statusElement.className = "text-green-600";
        toggleBtn.textContent = "Pause";
        
        // Restart intervals
        startIntervals();
        logEvent("Simulation activated");
      } else {
        statusElement.textContent = "Paused";
        statusElement.className = "text-red-600";
        toggleBtn.textContent = "Resume";
        
        // Clear intervals
        clearInterval(mouseInterval);
        clearInterval(keyInterval);
        clearInterval(updateInterval);
        logEvent("Simulation paused");
      }
    }
    
    // Start all intervals
    function startIntervals() {
      mouseInterval = setInterval(simulateMouseMove, 15000); // every 15 seconds
      keyInterval = setInterval(simulateKeyPress, 60000); // every 60 seconds
      updateInterval = setInterval(updateNextEventTime, 1000); // update countdown every second
      
      // Trigger initial events
      simulateMouseMove();
      updateNextEventTime();
    }
    
    // Setup event listeners
    toggleBtn.addEventListener('click', toggleActive);
    
    // Initial setup
    startIntervals();
    logEvent("Application started");
  </script>
</body>
</html>